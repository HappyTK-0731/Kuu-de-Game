<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Sadge çš„è·å ´ç”Ÿå­˜æˆ°ï¼šçµ‚æ¥µç‰ˆ</title>
    <style>
        :root {
            --pua-color: #ff4757;
            --safe-color: #2ed573;
            --bg-chat: #f2f0e4; 
            --bg-container: #ffffff; 
            --text-primary: #2c3e50; 
            --chat-bar-green: #a0e7c6; 
        }

        /* ä½¿ç”¨ dvh ç¢ºä¿æ‰‹æ©Ÿç€è¦½å™¨ä¸è¢«æˆªæ–· */
        body {
            background-color: var(--bg-chat);
            color: var(--text-primary);
            font-family: 'Microsoft JhengHei', sans-serif;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            height: 100dvh; 
            margin: 0; 
            padding: 10px;
            box-sizing: border-box;
            overflow: hidden;
            touch-action: manipulation;
        }

        h1 { margin: 5px 0; font-size: 1.2rem; flex-shrink: 0; }

        /* éŠæˆ²ä¸»å®¹å™¨ï¼šéŸ¿æ‡‰å¼å¡«æ»¿ */
        #game-container {
            position: relative; 
            width: 100%;
            max-width: 400px; 
            flex: 1; 
            background: var(--bg-container);
            border: 2px solid #dcdde1; 
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow: hidden; 
            display: flex; 
            flex-direction: column;
            margin-bottom: 10px;
        }

        /* Line ç¾¤çµ„æ¨™é¡Œè¨­å®š */
        .chat-header {
            width: 100%; height: 45px; background: white;
            display: flex; align-items: center; padding: 0 15px;
            box-sizing: border-box; border-bottom: 1px solid #f1f2f6; z-index: 10;
            flex-shrink: 0;
        }
        .chat-header .back { font-size: 18px; margin-right: 10px; }
        #group-name { font-weight: bold; font-size: 15px; flex-grow: 1; text-align: left; }
        .chat-header .icons { font-size: 16px; color: #2f3542; letter-spacing: 3px; }

        #play-area { 
            position: relative; 
            flex: 1; 
            width: 100%; 
            overflow: hidden; 
        }

        /* 3D æ“æ§æŒ‰éˆ• UI */
        .controller-ui {
            position: absolute; 
            bottom: 10px; 
            width: 100%;
            display: flex; 
            justify-content: space-around; 
            padding: 0 15px; 
            box-sizing: border-box; 
            z-index: 10;
        }

        .key-btn {
            width: 80px; height: 80px; 
            background: #f8f9fa;
            border: 2px solid #d2dae2; border-radius: 15px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 5px 0 #bdc3c7; 
            transition: all 0.05s; position: relative;
            cursor: pointer; touch-action: none;
            user-select: none;
        }

        .key-btn.active {
            transform: translateY(3px);
            box-shadow: 0 2px 0 #bdc3c7;
            background: #e1f5fe;
        }

        .key-btn .key-icon { font-size: 24px; }
        .key-btn .key-desc { font-size: 10px; font-weight: bold; margin-top: 2px; }

        /* è®€å–çª— (åˆ¤å®šå€) */
        .judgment-zone {
            position: absolute; 
            bottom: 105px; 
            width: 100%; height: 70px;
            border-top: 2px dashed #dfe4ea; border-bottom: 2px dashed #dfe4ea;
            background: rgba(0,0,0,0.02); pointer-events: none;
            display: flex; align-items: center; justify-content: center;
            color: #dfe4ea; font-size: 10px; font-weight: bold;
        }

        #sadge {
            position: absolute; 
            bottom: 185px; 
            left: 50%; transform: translateX(-50%); 
            font-size: 50px; z-index: 9;
        }

        .bubble {
            position: absolute; padding: 12px; border-radius: 18px;
            background: white; color: black; font-weight: bold; width: 140px;
            text-align: center; animation: fall linear forwards;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            font-size: 14px;
        }
        .pua { border: 3px solid var(--pua-color); background: #fffcfc; }
        .safe { border: 3px solid var(--safe-color); background: #fcfdfc; }

        @keyframes fall { 0% { top: -80px; } 100% { top: 105%; } }

        /* é£„å‡ºçš„å­—é«”ç‰¹æ•ˆ - åœç•™ 3 ç§’ */
        .hit-effect {
            position: absolute; 
            font-size: 24px; 
            font-weight: bold;
            z-index: 15;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3); 
            text-align: center; 
            width: 100%;
            pointer-events: none; 
            animation: fadeUp 3s ease-out forwards;
        }

        @keyframes fadeUp {
            0% { opacity: 1; transform: translate(-50%, 0); }
            70% { opacity: 1; transform: translate(-50%, -80px); } 
            100% { opacity: 0; transform: translate(-50%, -120px); } 
        }

        /* å„€è¡¨æ¿èˆ‡æŒ‰éˆ•çµ„ */
        .dashboard { flex-shrink: 0; font-size: 16px; font-weight: bold; margin: 5px 0; }
        .btn-group { flex-shrink: 0; margin-bottom: 10px; }
        
        #overlay {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.96); z-index: 20;
            justify-content: center; align-items: center; flex-direction: column; text-align: center; padding: 20px;
            box-sizing: border-box;
        }

        button { padding: 10px 20px; border:none; cursor:pointer; border-radius: 8px; font-weight: bold; }
        #start-btn { background:#2ed573; color:white; }
        #resign-btn { background:#ff4757; color:white; }
    </style>
</head>
<body>

    <h1>Sadge çš„è·å ´ç”Ÿå­˜æˆ° ğŸ¥º</h1>

    <div id="game-container">
        <div class="chat-header">
            <div class="back">ã€ˆ</div>
            <div id="group-name">é»æ“Šä¸‹æ–¹é–‹å§‹...</div>
            <div class="icons">ğŸ” ğŸ“ â˜°</div>
        </div>

        <div id="play-area">
            <div class="judgment-zone">JUDGMENT ZONE</div>
            <div id="sadge">ğŸ’ƒ</div>
            <div class="controller-ui">
                <div id="key-left" class="key-btn left">
                    <div class="key-icon">ğŸš«</div>
                    <div class="key-desc">å·²è®€ä¸å›</div>
                </div>
                <div id="key-right" class="key-btn right">
                    <div class="key-icon">ğŸ’¾</div>
                    <div class="key-desc">å“¡å·¥æ¬Šç›Š</div>
                </div>
            </div>

            <div id="overlay">
                <h2 id="overlay-title"></h2>
                <p id="overlay-desc"></p>
                <button onclick="location.reload()" style="background:#1e90ff; color:white;">æŠ•æ–°å±¥æ­· (é‡ä¾†)</button>
            </div>
        </div>
    </div>

    <div class="dashboard">
        è¦ºé†’å€¼: <span id="score">0</span> | <span id="status">æ½›æ°´ä¸­ ğŸ’ƒ</span>
    </div>

    <div class="btn-group">
        <button id="start-btn" onclick="startGame()">é€²å…¥ç¾¤çµ„</button>
        <button id="resign-btn" onclick="togglePause()" style="display:none;">æé›¢è· (æš«åœ)</button>
    </div>

    <script>
        const playArea = document.getElementById('play-area');
        const groupNameEl = document.getElementById('group-name');
        const sadge = document.getElementById('sadge');
        const scoreEl = document.getElementById('score');
        const statusEl = document.getElementById('status');
        const startBtn = document.getElementById('start-btn');
        const resignBtn = document.getElementById('resign-btn');
        const overlay = document.getElementById('overlay');
        const keyLeft = document.getElementById('key-left');
        const keyRight = document.getElementById('key-right');

        let score = 0;
        let gameActive = false;
        let isPaused = false;
        let bubbleInterval;
        let activeBubbles = [];

        const groupNames = ["å³è‰¯å¿ƒè€å¸«å¯¦é©—å®¤", "æ—é“å¾·å°ˆæ¡ˆå°çµ„", "å¤§å®¶å…±é«”æ™‚è‰±çµ„", "24å°æ™‚ç†±ç·šçµ„", "æ ½åŸ¹æ–°äººå§”å“¡æœƒ", "è–ªæ°´å°å·ç›£æ§ä¸­å¿ƒ"];
        const puaQuotes = ["æˆ‘åœ¨æ ½åŸ¹ä½ ", "é€™é»äº‹éƒ½åšä¸å¥½", "å…¬å¸æ˜¯ä½ å®¶", "å¤–é¢ç’°å¢ƒæ›´å·®", "é€±æœ«å›ä¸€ä¸‹è¨Šæ¯", "æˆ‘å°ä½ å¾ˆå¤±æœ›"];
        const safeQuotes = ["æˆ‘æœ‰å‹åŸºæ³•", "æˆ‘è¦ä¸‹ç­äº†", "è«‹çµ¦åŠ ç­è²»", "é€™ä¸åˆç†", "å·²è®€ä¸å›"];

        function startGame() {
            gameActive = true; score = 0; updateUI();
            groupNameEl.innerText = groupNames[Math.floor(Math.random() * groupNames.length)];
            startBtn.style.display = 'none'; resignBtn.style.display = 'inline-block';
            sadge.innerText = "ğŸ¥º";
            bubbleInterval = setInterval(createBubble, 1200);
        }

        function createBubble() {
            if (isPaused || !gameActive) return;
            const bubble = document.createElement('div');
            const isPUA = Math.random() > 0.4;
            bubble.className = `bubble ${isPUA ? 'pua' : 'safe'}`;
            bubble.innerText = isPUA ? puaQuotes[Math.floor(Math.random()*puaQuotes.length)] : safeQuotes[Math.floor(Math.random()*safeQuotes.length)];
            bubble.style.left = (Math.random() * (playArea.offsetWidth - 150)) + 'px';
            bubble.style.animationDuration = '3s';
            playArea.appendChild(bubble);
            activeBubbles.push({ el: bubble, isPUA: isPUA });

            bubble.addEventListener('animationend', () => {
                if (bubble.parentElement) {
                    if (isPUA) { score -= 10; updateUI(); }
                    removeBubble(bubble);
                }
            });
        }

        function removeBubble(el) {
            el.remove();
            activeBubbles = activeBubbles.filter(b => b.el !== el);
        }

        function triggerAction(isLeft) {
            if (!gameActive || isPaused) return;
            const areaRect = playArea.getBoundingClientRect();
            let target = null;
            activeBubbles.forEach(b => {
                const rect = b.el.getBoundingClientRect();
                const dist = areaRect.bottom - rect.bottom;
                // åˆ¤å®šç¯„åœ
                if (dist > 60 && dist < 200) {
                    if (!target || dist < target.dist) target = { ...b, dist: dist };
                }
            });
            handleAction(target, isLeft);
        }

        function handleAction(target, isLeftKey) {
            if (!target) return;
            if (isLeftKey && target.isPUA) {
                score += 15; showHitEffect("å·²è®€ä¸å›ï¼ğŸš«", "#2ed573"); removeBubble(target.el);
            } else if (!isLeftKey && !target.isPUA) {
                score += 15; showHitEffect("å¥´æ€§ã„…ã„…ï¼ğŸ’¾", "#2ed573"); removeBubble(target.el);
            } else {
                score -= 20; showHitEffect("å¥´æ€§çˆ†ç™¼ï¼ğŸ˜­", "#ff4757"); removeBubble(target.el);
                sadge.innerText = "ğŸ˜­"; setTimeout(() => {if(gameActive) sadge.innerText = "ğŸ¥º"}, 500);
            }
            updateUI();
        }

        function showHitEffect(text, color) {
            const effect = document.createElement('div');
            effect.className = 'hit-effect'; 
            effect.innerText = text; 
            effect.style.color = color;
            effect.style.bottom = '200px'; 
            effect.style.left = '50%'; 
            effect.style.transform = 'translateX(-50%)';
            playArea.appendChild(effect);
            setTimeout(() => { if (effect.parentElement) effect.remove(); }, 3000);
        }

        // è§¸æ§èˆ‡æŒ‰éµé›™æ”¯æ´
        keyLeft.addEventListener('pointerdown', (e) => { e.preventDefault(); keyLeft.classList.add('active'); triggerAction(true); });
        keyLeft.addEventListener('pointerup', () => keyLeft.classList.remove('active'));
        keyRight.addEventListener('pointerdown', (e) => { e.preventDefault(); keyRight.classList.add('active'); triggerAction(false); });
        keyRight.addEventListener('pointerup', () => keyRight.classList.remove('active'));

        window.addEventListener('keydown', (e) => {
            if (e.key === "ArrowLeft") { keyLeft.classList.add('active'); triggerAction(true); }
            if (e.key === "ArrowRight") { keyRight.classList.add('active'); triggerAction(false); }
        });
        window.addEventListener('keyup', (e) => {
            if (e.key === "ArrowLeft") keyLeft.classList.remove('active');
            if (e.key === "ArrowRight") keyRight.classList.remove('active');
        });

        function togglePause() {
            isPaused = !isPaused;
            if (isPaused) {
                clearInterval(bubbleInterval); overlay.style.display = 'flex';
                document.getElementById('overlay-title').innerText = "ğŸ–ï¸ é›¢è·åº¦å‡ä¸­";
                const bubbles = document.querySelectorAll('.bubble');
                bubbles.forEach(b => b.style.animationPlayState = 'paused');
            } else {
                bubbleInterval = setInterval(createBubble, 1200); overlay.style.display = 'none';
                const bubbles = document.querySelectorAll('.bubble');
                bubbles.forEach(b => b.style.animationPlayState = 'running');
            }
        }

        function updateUI() {
            scoreEl.innerText = score;
            if (score >= 200) statusEl.innerText = "æº–å‚™é€€ç¾¤ ğŸ˜ ";
            else if (score < 0) statusEl.innerText = "å¥´æ€§æ·±é‡ â›“ï¸";
            else statusEl.innerText = gameActive ? "è¢« Tag ä¸­ ğŸ¥º" : "æ½›æ°´ä¸­ ğŸ’ƒ";
            if (score <= -100) endGame("GGäº†", "ä½ è®Šæˆäº†éš¨å‚³éš¨åˆ°çš„å®Œç¾å¥´éš¸ã€‚");
            if (score >= 100) endGame("è‡ªç”±äº†", "ä½ æˆåŠŸé€€ç¾¤ä¸¦å°é–äº†è€é—†ï¼");
        }

        function endGame(title, desc) {
            gameActive = false; clearInterval(bubbleInterval);
            overlay.style.display = 'flex';
            document.getElementById('overlay-title').innerText = title;
            document.getElementById('overlay-desc').innerText = desc;
        }
    </script>
</body>
</html>
